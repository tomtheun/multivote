#set($resPath="download/resources/com.tngtech.confluence.plugin.multivote:resources") <!-- TODO read from property? -->
#requireResource("confluence.web.resources:jquery")
#requireResource("com.tngtech.confluence.plugin.multivote:resources")
<fieldset class="hidden parameters">
    <input type="hidden" id="multivotePageId" value="$content.getIdAsString()"/>
    <input type="hidden" id="notInterestedImage" value="$req.contextPath/$resPath/checkbox_unchecked.png" />
    <input type="hidden" id="interestedImage" value="$req.contextPath/$resPath/checkbox_checked.png" />
    <input type="hidden" id="progressImage" value="$req.contextPath/$resPath/roller.gif" />
</fieldset>

<table class="grid" data-tableid="$tableId">
    <thead>
        <tr>
            #foreach ( $header in $headers )
                <th>$header</th>
            #end
            <th>$action.getText('multivote.result')</th>
            <th>$action.getText('multivote.vote')</th>
        </tr>
    </thead>
    <tbody>
    #foreach ( $item in $items )
        #set ($interested = $item.isInterested($req.remoteUser))
        #if ($interested)
            #set ($classIntr = "interested")
            #set ($invInterested = "false")
            #set ($image = "checkbox_checked")
        #else
            #set ($classIntr = "notInterested")
            #set ($invInterested = "true")
            #set ($image = "checkbox_unchecked")
        #end
        <tr class=$classIntr>
            #foreach ( $field in $item.getFields() )
                <td>$field</td>
            #end
            <td id="audience.$generalUtil.urlEncode($item.idName)" title="$multiVote.getUserFullNamesAsString($item.audience)">$item.audienceCount</td>
            <td align="center">
                <form action="${req.contextPath}$generalUtil.customGetPageUrl($content)" method="post">
                    <input type="hidden" name="multivote.tableId" value="$generalUtil.urlEncode($tableId)" />
                    <input type="hidden" name="multivote.idname" value="$generalUtil.urlEncode($item.idName)" />
                    <input type="hidden" name="multivote.interested" value="$invInterested" />
                    <input type="image" id="multivote.$generalUtil.urlEncode($item.idName)" data-interest="$invInterested" src="$req.contextPath/$resPath/${image}.png" width=20 border=0 align="absmiddle" />
                </form>
            </td>
        </tr>
    #end
    </tbody>
</table>
